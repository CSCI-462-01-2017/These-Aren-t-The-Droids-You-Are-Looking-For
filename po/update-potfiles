#!/bin/bash

inspect=$1

top=$(git rev-parse --show-toplevel)

# The awk script alphabetically sorts the files list, with files first and then directories
# ("width first traversal").
allfiles=$(cd "$top" && git ls-files --no-empty-directory --exclude-standard $inspect | gawk '
BEGIN { IGNORECASE = 1; lines = 0; }
{
  match("/" $0, "(/.*/)[^/]+$", result);
  dirname = result[1];
  d[dirname] = dirname;
  f[dirname][length(f[dirname])+1] = $0;
}
END {
  asort(d);
  for (i=1; i<=length(d); i++) {
    dirname = d[i];
    asort(f[dirname]);
    for (j=1; j<=length(f[dirname]); j++) {
      print f[dirname][j];
    }
  }
}')

# Only keep files containing gettext markers

echo "# List of source files containing translatable strings, automatically"
echo "# generated by update-potfiles. Do not edit by hand."

for i in $allfiles ; do
	case ${i##*.} in
		# source files
		("c" | "h")
			if grep -E '_\(\"' "$top/$i" &>/dev/null; then
				echo $i;
			fi;;
	esac
done
